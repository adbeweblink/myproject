<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adobe AI 點數計算機 (商用旗艦版)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        
        body { font-family: 'Noto Sans TC', sans-serif; }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes slideLeft { from { transform: translateX(20px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes fadeInDown { from { transform: translate(-50%, 20px); opacity: 0; } to { transform: translate(-50%, 0); opacity: 1; } }
        @keyframes zoomIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes pulse-slow { 0%, 100% { opacity: 1; } 50% { opacity: .8; } }
        @keyframes bounce-gentle { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

        .animate-fadeIn { animation: fadeIn 0.3s ease-out; }
        .animate-slideUp { animation: slideUp 0.3s ease-out; }
        .animate-slideLeft { animation: slideLeft 0.3s ease-out; }
        .animate-fadeInDown { animation: fadeInDown 0.3s ease-out; }
        .animate-zoomIn { animation: zoomIn 0.2s ease-out; }
        .animate-pulse-slow { animation: pulse-slow 3s infinite; }
        .animate-bounce-gentle { animation: bounce-gentle 2s infinite; }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 20px; width: 20px; border-radius: 50%;
            background: #ffffff; border: 2px solid currentColor; cursor: pointer;
            margin-top: -8px; box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px; cursor: pointer; background: #e2e8f0; border-radius: 2px;
        }
    </style>
</head>
<body class="bg-slate-200 text-slate-800 font-sans pb-24 sm:pb-0 selection:bg-[#0265DC] selection:text-white">

    <!-- Header -->
    <header class="bg-white/95 backdrop-blur-md p-4 px-6 border-b border-gray-200 flex flex-col sm:flex-row justify-between items-center sticky top-0 z-40 gap-4 sm:gap-0 shadow-sm">
        <h1 class="text-xl font-bold flex items-center gap-3">
            <div class="bg-gradient-to-br from-orange-500 via-red-500 to-purple-600 text-white p-2 rounded-lg shadow-md">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>
            </div>
            <span class="text-slate-800 font-extrabold tracking-tight">
                Adobe AI <span class="text-transparent bg-clip-text bg-gradient-to-r from-orange-600 via-red-600 to-purple-600">點數計算機</span>
            </span>
        </h1>
        
        <div class="flex flex-col items-center relative">
            <div id="plan-switcher" class="bg-gray-100 p-1.5 rounded-full flex items-center shadow-inner border border-gray-200 relative overflow-hidden">
                <button onclick="setPlan('general')" id="btn-general" class="px-6 py-2 rounded-full text-sm font-bold transition-all duration-300 relative z-10 flex items-center gap-2 bg-white text-slate-900 shadow-md transform scale-105">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg> 一般/舊版用戶
                </button>
                <button onclick="setPlan('pro')" id="btn-pro" class="px-6 py-2 rounded-full text-sm font-bold transition-all duration-300 relative z-10 flex items-center gap-2 text-gray-500 hover:text-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14"/></svg> CC Pro 用戶
                </button>
            </div>
            <!-- Guide Step 1 -->
            <div id="guide-step-1" class="absolute top-full mt-3 bg-slate-900 text-white text-xs font-bold px-3 py-2 rounded-lg shadow-xl animate-bounce-gentle z-50 whitespace-nowrap">
                <div class="absolute -top-1 left-1/2 -translate-x-1/2 w-2 h-2 bg-slate-900 rotate-45"></div>
                第一步：請先確認您的身分
            </div>
        </div>

        <div class="flex gap-4 items-center">
            <a href="https://adbeweblink.github.io/myproject/firefly-biz-matrix.html" target="_blank" rel="noopener noreferrer" class="hidden sm:flex items-center gap-2 text-slate-600 hover:text-[#0265DC] font-medium text-sm transition-colors hover:bg-slate-100 px-3 py-2 rounded-lg"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 3v18"/><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M3 9h18"/><path d="M3 15h18"/></svg> 比較方案</a>
            <div class="relative">
                <button onclick="openCart()" id="cart-btn-desktop" class="hidden sm:flex items-center gap-2 bg-[#0265DC] hover:bg-[#0256BD] text-white px-5 py-2.5 rounded-full font-bold transition-all shadow-md hover:shadow-lg active:scale-95 group relative">
                    <div class="relative">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>
                        <span id="cart-badge-desktop" class="hidden absolute -top-2 -right-2 bg-red-500 text-white text-[10px] font-bold w-4 h-4 rounded-full flex items-center justify-center ring-2 ring-white animate-bounce">0</span>
                    </div>
                    <span>需求清單</span>
                    <span id="total-badge-desktop" class="hidden bg-white/20 px-2 py-0.5 rounded text-xs font-mono">0</span>
                </button>
                <div id="guide-step-3-desktop" class="absolute top-full right-0 mt-3 bg-slate-900 text-white text-xs font-bold px-3 py-2 rounded-lg shadow-xl min-w-max z-50 hidden animate-bounce-gentle">
                    <div class="absolute -top-1 right-10 w-2 h-2 bg-slate-900 rotate-45"></div>
                    最後一步：查看統計結果
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-6xl mx-auto p-6 sm:p-12 relative">
        <div class="text-center mb-16 animate-fadeIn relative">
            <h2 class="text-3xl sm:text-4xl font-extrabold text-slate-900 mb-3 tracking-tight">規劃您的 AI 創意預算</h2>
            <p class="text-lg text-gray-500 max-w-2xl mx-auto leading-relaxed">選擇您的創作類型，精準估算 Adobe Firefly 與第三方模型所需的生成式點數。</p>
        </div>
        
        <div class="relative">
            <!-- Guide Step 2 -->
            <div id="guide-step-2" class="hidden absolute -top-14 left-0 right-0 flex justify-center z-50 pointer-events-none">
                 <div class="bg-slate-900 text-white px-4 py-2 rounded-full shadow-lg flex items-center gap-2 text-sm font-bold animate-bounce-gentle">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3l7.07 16.97 2.51-7.39 7.39-2.51L3 3z"/><path d="M13 13l6 6"/></svg> 第二步：點擊下方卡片開始估算
                    <div class="absolute -bottom-1 left-1/2 -translate-x-1/2 w-2 h-2 bg-slate-900 rotate-45"></div>
                </div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-3 gap-8" id="category-grid">
                <!-- Categories will be injected here -->
            </div>
        </div>

        <!-- Data Source Info -->
        <div class="mt-16 bg-white rounded-2xl p-8 text-sm text-gray-500 flex flex-col sm:flex-row gap-6 items-start border border-gray-100 shadow-sm mb-12">
            <div class="p-3 bg-blue-50 rounded-full text-[#0265DC]">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
            </div>
            <div class="flex-1">
                <div class="flex items-center justify-between flex-wrap gap-2 mb-2">
                    <p class="font-bold text-slate-900 text-base">關於費率計算與資料來源</p>
                    <span class="text-xs bg-gray-100 text-gray-500 px-2 py-1 rounded font-mono">費率基準：2025 年 12 月 16 日官方公告</span>
                </div>
                <p class="mb-4 leading-relaxed text-gray-600">本工具整合 Firefly 與合作夥伴模型 (Google, OpenAI, Luma 等)。<br/><span class="text-red-500 font-bold">*注意：</span>部分第三方模型費率已更新（如 Gemini 3 調整為 40 點），報價時請務必以官方最新頁面為準。</p>
                <div class="flex flex-wrap gap-4">
                    <a href="https://helpx.adobe.com/tw/creative-cloud/apps/generative-ai/generative-credits-faq.html" target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 text-slate-700 hover:text-[#0265DC] font-bold bg-gray-50 hover:bg-blue-50 px-4 py-2.5 rounded-lg transition-colors">官方費率表 <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" x2="21" y1="14" y2="3"/></svg></a>
                    <a href="https://helpx.adobe.com/tw/firefly/web/get-started/learn-the-basics/non-adobe-models-in-adobe-products.html" target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 text-slate-700 hover:text-[#0265DC] font-bold bg-gray-50 hover:bg-blue-50 px-4 py-2.5 rounded-lg transition-colors">第三方模型費率表 <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" x2="21" y1="14" y2="3"/></svg></a>
                </div>
            </div>
        </div>
    </main>

    <!-- Mobile Floating Action Bar -->
    <div class="sm:hidden fixed bottom-6 left-1/2 -translate-x-1/2 z-40 w-[92%] max-w-sm">
        <div id="guide-step-3-mobile" class="absolute -top-12 left-1/2 -translate-x-1/2 bg-slate-900 text-white text-xs font-bold px-3 py-2 rounded-lg shadow-xl whitespace-nowrap hidden animate-bounce-gentle z-50">
            最後一步：點此查看統計
            <div class="absolute -bottom-1 left-1/2 -translate-x-1/2 w-2 h-2 bg-slate-900 rotate-45"></div>
        </div>

        <button onclick="openCart()" class="w-full bg-[#1E1E1E] text-white shadow-2xl rounded-2xl p-4 flex justify-between items-center backdrop-blur-md border border-white/10">
            <div class="flex items-center gap-3">
                <div class="bg-white/10 p-2.5 rounded-xl backdrop-blur-sm relative">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>
                    <span id="cart-badge-mobile" class="hidden absolute -top-1.5 -right-1.5 bg-red-500 text-white text-[10px] font-bold w-4 h-4 rounded-full flex items-center justify-center border border-[#1E1E1E]">0</span>
                </div>
                <div class="text-left"><div class="text-[10px] text-gray-400 font-bold uppercase tracking-wider">預估總點數</div><div id="total-badge-mobile" class="font-bold text-xl leading-none font-mono tracking-tight">0</div></div>
            </div>
            <div class="flex items-center gap-2 text-sm font-bold text-white bg-white/10 px-4 py-2 rounded-lg">查看 <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg></div>
        </button>
    </div>

    <!-- Modals -->
    <div id="config-modal" class="hidden fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm animate-fadeIn">
        <div class="bg-white rounded-3xl w-full max-w-2xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
            <div id="config-modal-header" class="p-6 text-white flex justify-between items-center transition-colors">
                <div class="flex items-center gap-3">
                    <div id="config-modal-icon" class="bg-white/20 p-2 rounded-xl backdrop-blur-md"></div>
                    <div>
                        <h3 id="config-modal-title" class="text-xl font-bold"></h3>
                        <p id="config-modal-step" class="text-white/80 text-sm"></p>
                    </div>
                </div>
                <button onclick="closeModal('config-modal')" class="p-2 hover:bg-white/20 rounded-full transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg></button>
            </div>
            <div id="config-modal-body" class="p-6 overflow-y-auto flex-1 bg-slate-50 no-scrollbar">
                <!-- Dynamic Content -->
            </div>
        </div>
    </div>

    <!-- Cart Drawer -->
    <div id="cart-drawer-backdrop" class="hidden fixed inset-0 bg-black/50 z-40 transition-opacity duration-300 backdrop-blur-sm opacity-0" onclick="closeCart()"></div>
    <div id="cart-drawer" class="fixed top-0 right-0 h-full w-full sm:w-[480px] bg-white z-50 shadow-2xl transform transition-transform duration-300 translate-x-full flex flex-col">
        <!-- Header -->
        <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-white z-10 shadow-sm flex-none">
            <div>
                <h2 class="text-xl font-bold flex items-center gap-2 text-slate-900">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-[#0265DC]"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>
                    需求清單 
                    <span id="cart-count" class="bg-[#0265DC] text-white text-xs font-bold px-2 py-0.5 rounded-full">0</span>
                </h2>
                <div id="cart-user-label" class="text-[10px] text-gray-500 font-bold mt-1 bg-gray-100 px-2 py-0.5 rounded-md inline-block"></div>
            </div>
            <div class="flex gap-2">
                <button onclick="confirmReset()" class="p-2 hover:bg-red-50 text-slate-400 hover:text-red-500 rounded-full transition-colors" title="清空重算">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
                </button>
                <button onclick="closeCart()" class="p-2 hover:bg-gray-100 rounded-full text-slate-500 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                </button>
            </div>
        </div>

        <!-- Content -->
        <div id="cart-content" class="flex-1 overflow-y-auto p-5 space-y-4 bg-slate-50 min-h-0 no-scrollbar">
            <!-- Items injected via JS -->
        </div>

        <!-- Footer -->
        <div class="p-6 bg-white shadow-[0_-5px_30px_rgba(0,0,0,0.08)] border-t border-gray-100 z-20 flex-none" id="cart-footer">
            <!-- Footer details injected via JS -->
        </div>
    </div>

    <!-- Reset Modal -->
    <div id="reset-modal" class="hidden fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm animate-fadeIn">
        <div class="bg-white rounded-2xl p-6 max-w-sm w-full shadow-2xl scale-100 animate-zoomIn">
            <h3 class="text-xl font-bold mb-2 text-slate-900">確定要清空目前身分的清單嗎？</h3>
            <p class="text-gray-500 mb-6 text-sm">這將會移除目前身分的選購項目。</p>
            <div class="flex gap-3">
                <button onclick="closeModal('reset-modal')" class="flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg font-bold hover:bg-gray-200 transition-colors">取消</button>
                <button onclick="executeReset()" class="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg font-bold hover:bg-red-700 transition-colors">確認清空</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="hidden fixed bottom-28 sm:bottom-10 left-1/2 transform -translate-x-1/2 bg-slate-800 text-white px-6 py-3 rounded-full shadow-2xl z-[100] flex items-center gap-3 animate-fadeInDown border border-white/10">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-green-400"><path d="M20 6 9 17l-5-5"/></svg>
        <span id="toast-message" class="font-bold whitespace-nowrap"></span>
    </div>

    <script>
        // ============================
        // 1. Data Models (Updated 2025-12-16)
        // ============================
        const VIDEO_MODELS = {
            adobe: { name: 'Adobe Firefly', desc: '首選推薦，商務安全且原生整合。', tags: ['商業安全', '穩定'], models: [{ id: 'fv', name: 'Firefly Video', type: 'gen', desc: '標準影片生成模型。', rates: { '540p': 20, '720p': 50, '1080p': 100 } }, { id: 'ge', name: 'Premiere 生成式延伸', type: 'gen', desc: 'Premiere Pro 內建延伸功能。', rates: { '1080p': 100, '4k': 150 } }] },
            openai: { name: 'OpenAI Sora', desc: '具備頂級畫質與物理一致性。', tags: ['頂級畫質', '物理一致性'], models: [
                { id: 's2', name: 'Sora 2', type: 'gen', rates: { '全解析度': 30 }, desc: '經典 OpenAI 影片模型。' }, 
                { id: 's2p', name: 'Sora 2 Pro', isNew: true, type: 'gen', rates: { '全解析度': 90 }, desc: 'NEW: 專業版 Sora，細節與產量更高。' }
            ] },
            runway: { name: 'Runway', desc: '藝術風格控制力強，適合電影感創作。', tags: ['風格控制', '電影感'], models: [
                { id: 'r45', name: 'Runway Gen-4.5', isNew: true, type: 'gen', rates: { '720p': 35 }, desc: 'NEW: 最新旗艦級生成模型。' }, 
                { id: 'r4', name: 'Runway Gen-4', type: 'gen', rates: { '720p': 20, '1080p': 40 }, desc: '經典高效模型。' }
            ] },
            luma: { name: 'Luma AI', desc: '動態運鏡流暢，適合高穩定性場景。', tags: ['運鏡流暢', '速度快'], models: [
                { id: 'r2f', name: 'Ray2 Flash', isNew: true, type: 'gen', rates: { '540p': 10, '720p': 25, '1080p': 50, '4k': 75 }, desc: 'NEW: 極速預覽，費率極低。' }, 
                { id: 'r3h', name: 'Ray3 (HDR)', isNew: true, type: 'gen', rates: { '720p': 300, '4k': 450 }, desc: 'NEW: 高動態範圍超高品質。' }, 
                { id: 'r3s', name: 'Ray3 (SDR)', type: 'gen', rates: { '720p': 100, '4k': 150 }, desc: '最新一代標準版。' }
            ] },
            topaz: { name: 'Topaz Labs', desc: '專精於影片畫質增強與放大。', tags: ['修復專家', 'Upscale'], models: [{ id: 'ta', name: 'Topaz Astra', isNew: true, type: 'gen', rates: { 'Fast 1080p': 5, 'Fast 4K': 10, 'Quality 1080p': 10, 'Quality 4K': 20 }, desc: 'NEW: 影片畫質修復專家。' }] }
        };

        const IMAGE_MODELS = [
            { id: 'g3', provider: 'Google', name: 'Gemini 3', isNew: true, cost: 40, type: 'gen', desc: '費率更新為 40 點，專業級圖像生成。' },
            { id: 'g25', provider: 'Google', name: 'Gemini 2.5 Flash', cost: 10, type: 'gen', desc: '快速發想的首選模型。' },
            { id: 'f2', provider: 'Black Forest', name: 'FLUX.2', isNew: true, cost: 20, type: 'gen', desc: 'NEW: 新一代生產力級繪圖模型。' },
            { id: 'fv4', provider: 'Adobe', name: 'Firefly Image 4', cost: 1, type: 'std', desc: '商用標準模型（Pro身份無限使用）。' },
            { id: 'psa', provider: 'Adobe', name: 'Photoshop 生成式填色', cost: 10, type: 'gen', desc: 'Photoshop 內非 Firefly 之填色功能。' }
        ];

        const AUDIO_MODELS = [
            { id: 'e11', name: 'ElevenLabs Multilingual v2', isNew: true, cost: 15, unit: '1k字', desc: 'NEW: 擬真多國語言配音（每千字元）。' },
            { id: 'mb', name: 'GenMusic (生成音樂)', cost: 20, unit: '分', desc: '高品質商用背景音樂生成。' }
        ];

        const CATEGORIES = {
            image: { id: 'image', title: '圖像設計', subtitle: 'Firefly 4, FLUX.2, Gemini 3 等。', icon: '<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>', bg: 'bg-gradient-to-br from-orange-400 to-pink-600', color: 'text-orange-600', type: 'image' },
            video: { id: 'video', title: '影片生成', subtitle: 'Sora 2 Pro, Runway 4.5, Luma 等。', icon: '<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M7 3v18"/><path d="M3 7.5h4"/><path d="M3 12h18"/><path d="M3 16.5h4"/><path d="M17 3v18"/><path d="M17 7.5h4"/><path d="M17 16.5h4"/></svg>', bg: 'bg-gradient-to-br from-blue-500 to-indigo-600', color: 'text-blue-600', type: 'video' },
            audio: { id: 'audio', title: '音訊音樂', subtitle: 'ElevenLabs 配音、音樂生成。', icon: '<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>', bg: 'bg-gradient-to-br from-yellow-400 to-orange-500', color: 'text-yellow-600', type: 'audio' }
        };

        // ============================
        // 2. Application State
        // ============================
        let state = {
            carts: { general: [], pro: [] },
            userPlan: 'general',
            activeCategory: null,
            modalStep: 1,
            guideStep: 1,
            showGuide: true,
            selections: { step1: null, brand: null, model: null, res: null, qty: 1 }
        };

        // ============================
        // 3. UI Helpers
        // ============================
        function updateGuide() {
            document.querySelectorAll('[id^="guide-step-"]').forEach(el => el.classList.add('hidden'));
            document.getElementById('plan-switcher').classList.remove('ring-4', 'ring-[#0265DC]/30', 'animate-pulse');

            if (!state.showGuide) return;
            if (state.guideStep === 1) {
                document.getElementById('guide-step-1').classList.remove('hidden');
                document.getElementById('plan-switcher').classList.add('ring-4', 'ring-[#0265DC]/30', 'animate-pulse');
            } else if (state.guideStep === 2) {
                document.getElementById('guide-step-2').classList.remove('hidden');
            } else if (state.guideStep === 3) {
                document.getElementById('guide-step-3-desktop').classList.remove('hidden');
                document.getElementById('guide-step-3-mobile').classList.remove('hidden');
            }
        }

        function setPlan(plan) {
            state.userPlan = plan;
            const btnG = document.getElementById('btn-general'), btnP = document.getElementById('btn-pro');
            if (plan === 'general') {
                btnG.className = 'px-6 py-2 rounded-full text-sm font-bold bg-white shadow-md transform scale-105 transition-all';
                btnP.className = 'px-6 py-2 rounded-full text-sm font-bold text-gray-500';
            } else {
                btnP.className = 'px-6 py-2 rounded-full text-sm font-bold bg-gradient-to-r from-[#0265DC] to-[#5143E6] text-white shadow-md transform scale-105 transition-all';
                btnG.className = 'px-6 py-2 rounded-full text-sm font-bold text-gray-500';
            }
            if (state.guideStep === 1) { state.guideStep = 2; updateGuide(); }
            updateCartDisplay();
        }

        function showToast(msg) {
            const t = document.getElementById('toast'); document.getElementById('toast-message').innerText = msg;
            t.classList.remove('hidden'); setTimeout(()=>t.classList.add('hidden'), 2500);
        }

        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }

        function openCategoryModal(key) {
            state.activeCategory = CATEGORIES[key];
            state.modalStep = 1;
            state.selections = { step1: null, brand: null, model: null, res: null, qty: 1 };
            const header = document.getElementById('config-modal-header');
            header.className = `p-6 text-white flex justify-between items-center ${state.activeCategory.bg}`;
            document.getElementById('config-modal-icon').innerHTML = state.activeCategory.icon;
            document.getElementById('config-modal-title').innerText = state.activeCategory.title;
            renderModal();
            document.getElementById('config-modal').classList.remove('hidden');
        }

        // ============================
        // 4. Modal Engine
        // ============================
        function renderModal() {
            const body = document.getElementById('config-modal-body');
            const stepLabel = document.getElementById('config-modal-step');
            const step = state.modalStep, cat = state.activeCategory.type;
            stepLabel.innerText = `步驟 ${step} / ${cat === 'image' ? 4 : 3}`;
            body.innerHTML = '';

            if (step === 1) {
                const options = cat === 'video' ? Object.keys(VIDEO_MODELS) : (cat === 'image' ? ['image_gen', 'enhance', 'vector'] : ['audio']);
                const title = document.createElement('h4'); title.className = "font-bold text-gray-700 mb-4"; 
                title.innerText = cat === 'image' ? '請選擇服務類型：' : '請選擇供應商：';
                body.appendChild(title);
                const grid = document.createElement('div'); grid.className = "grid grid-cols-1 sm:grid-cols-2 gap-4 animate-slideLeft";
                options.forEach(opt => {
                    const btn = document.createElement('button');
                    btn.className = "bg-white p-5 rounded-xl border border-gray-200 shadow-sm hover:border-blue-400 hover:bg-blue-50 text-left transition-all";
                    let label = opt; 
                    if(cat==='video') label = VIDEO_MODELS[opt].name; 
                    else if(cat==='image') { const m={'image_gen':'圖像生成','enhance':'畫質修復','vector':'向量設計'}; label=m[opt]; } 
                    else label='音訊服務';
                    btn.innerHTML = `<div class="font-bold text-lg">${label}</div>`;
                    btn.onclick = () => { state.selections.step1 = opt; state.modalStep = 2; renderModal(); };
                    grid.appendChild(btn);
                });
                body.appendChild(grid);
            } 
            else if (step === 2) {
                const btn = document.createElement('button'); btn.innerText = "← 返回"; btn.className="text-xs text-gray-400 mb-2 hover:text-blue-500 transition-colors"; btn.onclick=()=>{state.modalStep=1;renderModal();}; body.appendChild(btn);
                if (cat === 'image') {
                    const brands = [...new Set(IMAGE_MODELS.map(m => m.provider))];
                    const grid = document.createElement('div'); grid.className = "grid grid-cols-2 gap-3 animate-slideLeft";
                    brands.forEach(b => {
                        const bbtn = document.createElement('button'); bbtn.className="bg-white p-4 rounded-xl border border-gray-200 font-bold text-slate-700 hover:border-blue-400 hover:bg-blue-50 transition-all"; bbtn.innerText = b;
                        bbtn.onclick = () => { state.selections.brand = b; state.modalStep = 3; renderModal(); };
                        grid.appendChild(bbtn);
                    });
                    body.appendChild(grid);
                } else {
                    renderModelList(body, cat === 'video' ? VIDEO_MODELS[state.selections.step1].models : AUDIO_MODELS);
                }
            } 
            else if (step === 3 && cat === 'image') {
                const btn = document.createElement('button'); btn.innerText = "← 返回"; btn.className="text-xs text-gray-400 mb-2 hover:text-blue-500 transition-colors"; btn.onclick=()=>{state.modalStep=2;renderModal();}; body.appendChild(btn);
                renderModelList(body, IMAGE_MODELS.filter(m => m.provider === state.selections.brand));
            } 
            else {
                renderConfigUI(body);
            }
        }

        function renderModelList(container, list) {
            const wrapper = document.createElement('div'); wrapper.className = "space-y-3 animate-slideLeft";
            list.forEach(m => {
                const btn = document.createElement('button');
                btn.className = "w-full bg-white p-4 rounded-xl border border-gray-200 text-left flex justify-between items-center group transition-all hover:border-blue-400";
                const isFree = state.userPlan === 'pro' && m.type === 'std';
                const costDisp = m.rates ? '依規格計費' : (isFree ? '<span class="text-green-600 font-bold">無限使用</span>' : `${m.cost} 點`);
                btn.innerHTML = `<div><div class="font-bold flex items-center">${m.name}${m.isNew?'<span class="ml-2 bg-red-500 text-white text-[9px] px-1 rounded animate-pulse font-black">NEW</span>':''}</div><div class="text-xs text-gray-400">${m.desc}</div></div><div class="text-sm font-bold text-slate-700">${costDisp}</div>`;
                btn.onclick = () => { state.selections.model = m; if(m.rates) state.selections.res = Object.keys(m.rates)[0]; state.modalStep = state.activeCategory.type==='image'?4:3; renderModal(); };
                wrapper.appendChild(btn);
            });
            container.appendChild(wrapper);
        }

        function renderConfigUI(container) {
            const m = state.selections.model;
            const unit = m.unit || (state.activeCategory.type==='video'?'秒':'張');
            container.innerHTML = `<div class="bg-white p-6 rounded-2xl border border-gray-200 animate-slideLeft"><h4 class="font-bold text-xl">${m.name}</h4><p class="text-sm text-gray-400 mb-6">${m.desc}</p>
                ${m.rates ? `<div class="mb-6"><label class="text-xs font-bold text-gray-500 uppercase tracking-widest">解析度規格</label><div class="grid grid-cols-2 gap-2 mt-2" id="res-grid"></div></div>` : ''}
                <div class="mb-4"><label class="text-xs font-bold text-gray-500 uppercase tracking-widest">預估產量 (${unit})</label><input type="number" id="qty-input" value="1" class="w-full text-3xl font-bold p-2 border-b-2 border-gray-100 outline-none font-mono text-center bg-transparent">
                <input type="range" id="qty-slider" min="1" max="1000" value="1" class="w-full mt-4 accent-blue-600"></div></div>
                <div class="bg-slate-900 text-white p-5 rounded-2xl flex justify-between items-center mt-6 shadow-xl"><div class="text-xs text-slate-400 font-bold">預估扣點<div id="modal-cost" class="text-3xl font-bold text-yellow-400">0</div></div>
                <button onclick="commitAdd()" class="bg-white text-slate-900 px-6 py-3 rounded-xl font-bold transition-all active:scale-95">加入清單</button></div>`;
            
            if(m.rates) {
                const resG = document.getElementById('res-grid');
                Object.entries(m.rates).forEach(([r, c]) => {
                    const rbtn = document.createElement('button'); rbtn.innerText = r;
                    rbtn.className = state.selections.res === r ? 'bg-blue-600 text-white rounded-lg p-3 text-xs font-bold shadow-md' : 'bg-gray-100 rounded-lg p-3 text-xs text-gray-500 hover:bg-gray-200';
                    rbtn.onclick = () => { state.selections.res = r; renderModal(); };
                    resG.appendChild(rbtn);
                });
            }

            const inp = document.getElementById('qty-input'), sli = document.getElementById('qty-slider'), costEl = document.getElementById('modal-cost');
            const update = () => {
                const q = parseInt(inp.value)||0; state.selections.qty = q;
                const rate = (state.userPlan==='pro'&&m.type==='std') ? 0 : (m.rates ? m.rates[state.selections.res] : m.cost);
                costEl.innerText = (rate * q).toLocaleString();
            };
            inp.oninput = () => { sli.value = inp.value; update(); };
            sli.oninput = () => { inp.value = sli.value; update(); };
            update();
        }

        // ============================
        // 5. Cart Engine
        // ============================
        function commitAdd() {
            const m = state.selections.model;
            const rate = (state.userPlan==='pro' && m.type==='std') ? 0 : (m.rates ? m.rates[state.selections.res] : m.cost);
            const item = {
                id: Date.now(), type: m.type, name: state.activeCategory.title,
                subname: `${m.name}${state.selections.res?` (${state.selections.res})`:''}`,
                qty: state.selections.qty, unit: m.unit||(state.activeCategory.type==='video'?'秒':'張'),
                costPerUnit: rate, totalCost: rate * state.selections.qty,
                formula: `${rate} 點 × ${state.selections.qty}`, detail: m.desc
            };
            state.carts[state.userPlan].push(item);
            if (state.guideStep === 2) { state.guideStep = 3; updateGuide(); }
            updateCartDisplay();
            showToast(`已新增：${item.subname} (${item.qty}${item.unit})`);
            closeModal('config-modal');
        }

        function updateCartDisplay() {
            const cart = state.carts[state.userPlan];
            const total = cart.reduce((s, i) => s + i.totalCost, 0);
            document.getElementById('cart-badge-desktop').innerText = cart.length;
            document.getElementById('cart-badge-mobile').innerText = cart.length;
            document.getElementById('total-badge-desktop').innerText = total.toLocaleString();
            document.getElementById('total-badge-mobile').innerText = total.toLocaleString();
            document.getElementById('cart-badge-desktop').classList.toggle('hidden', cart.length===0);
            document.getElementById('cart-badge-mobile').classList.toggle('hidden', cart.length===0);
            document.getElementById('total-badge-desktop').classList.toggle('hidden', total===0);

            const cont = document.getElementById('cart-content'); cont.innerHTML = '';
            document.getElementById('cart-user-label').innerText = `目前身分：${state.userPlan==='general'?'一般用戶':'CC Pro 用戶'}`;
            document.getElementById('cart-count').innerText = cart.length;

            if (cart.length === 0) {
                cont.innerHTML = '<div class="h-40 flex flex-col items-center justify-center text-gray-400 opacity-60 text-sm">尚未加入任何項目</div>';
            } else {
                cart.forEach(item => {
                    const div = document.createElement('div'); div.className = "bg-white border border-gray-100 rounded-2xl p-4 relative overflow-hidden shadow-sm";
                    div.innerHTML = `<div class="absolute left-0 top-0 bottom-0 w-1.5 ${item.name.includes('圖像')?'bg-orange-500':'bg-blue-500'}"></div>
                        <div class="flex justify-between items-start pl-3"><div class="pr-8"><div class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-1">${item.name}</div><div class="font-bold text-slate-900 text-sm">${item.subname}</div></div>
                        <button onclick="removeItem(${item.id})" class="text-gray-300 hover:text-red-500 transition-colors"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg></button></div>
                        <div class="pl-3 mt-1 text-[11px] text-gray-400 font-mono">${item.formula}</div>
                        <div class="flex justify-between items-end pl-3 pt-2 mt-2 border-t border-gray-50 text-xs font-bold text-slate-700"><div>${item.detail}</div><div>${item.totalCost.toLocaleString()} 點</div></div>`;
                    cont.appendChild(div);
                });
            }

            const footer = document.getElementById('cart-footer');
            const rec = total<=500 ? {name:'單一應用程式',color:'bg-blue-50 text-blue-800'} : (total<=4000 ? {name:'Firefly Pro (4,000點)',color:'bg-green-50 text-green-800'} : {name:'Firefly Premium (50,000點)',color:'bg-orange-50 text-orange-800'});
            footer.innerHTML = `<div class="flex justify-between items-end mb-4"><span class="text-gray-500 text-xs font-bold uppercase tracking-widest">預估總需求</span><span class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-orange-600 to-purple-600">${total.toLocaleString()}</span></div>
                <div class="p-4 rounded-xl mb-4 ${rec.color} text-sm font-bold shadow-inner">建議方案：${rec.name}</div>
                <div class="flex gap-2"><button onclick="copySummary()" class="flex-1 bg-gray-100 font-bold py-4 rounded-full flex items-center justify-center gap-2 hover:bg-gray-200 transition-all active:scale-95"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg> 複製</button>
                <button onclick="alert('表單已模擬送出')" class="flex-[2] bg-[#0265DC] text-white font-bold py-4 rounded-full shadow-lg transition-all active:scale-95 hover:bg-blue-700">送出諮詢</button></div>`;
        }

        function removeItem(id) { state.carts[state.userPlan] = state.carts[state.userPlan].filter(i => i.id !== id); updateCartDisplay(); }
        function confirmReset() { if(state.carts[state.userPlan].length>0) document.getElementById('reset-modal').classList.remove('hidden'); }
        function executeReset() { state.carts[state.userPlan]=[]; updateCartDisplay(); closeModal('reset-modal'); }
        
        function copySummary() {
            const c = state.carts[state.userPlan];
            const text = `【Adobe AI 點數報價預估】\n日期: ${new Date().toLocaleDateString()}\n身分: ${state.userPlan==='pro'?'CC Pro':'一般用戶'}\n---\n` + c.map(i => `${i.name} - ${i.subname}: ${i.totalCost} 點`).join('\n') + `\n---\n總預估點數: ${c.reduce((s,i)=>s+i.totalCost,0).toLocaleString()}`;
            const ta = document.createElement('textarea'); ta.value = text; ta.style.position='fixed'; ta.style.left='-9999px'; document.body.appendChild(ta); ta.select();
            document.execCommand('copy'); document.body.removeChild(ta); showToast("報價已複製到剪貼簿");
        }

        function openCart() { 
            if(state.guideStep===3) { state.showGuide=false; updateGuide(); }
            document.getElementById('cart-drawer').classList.remove('translate-x-full'); document.getElementById('cart-drawer-backdrop').classList.remove('hidden');
            setTimeout(()=>document.getElementById('cart-drawer-backdrop').classList.remove('opacity-0'), 10);
        }
        function closeCart() { document.getElementById('cart-drawer').classList.add('translate-x-full'); document.getElementById('cart-drawer-backdrop').classList.add('opacity-0'); setTimeout(()=>document.getElementById('cart-drawer-backdrop').classList.add('hidden'), 300); }

        window.onload = function() {
            const grid = document.getElementById('category-grid');
            ['image','video','audio'].forEach(k => {
                const c = CATEGORIES[k];
                const btn = document.createElement('button');
                btn.className = "group relative bg-white rounded-[2rem] p-8 shadow-sm hover:shadow-2xl transition-all flex flex-col justify-start border border-transparent hover:border-gray-100 text-left overflow-hidden";
                btn.onclick = () => openCategoryModal(k);
                btn.innerHTML = `<div class="absolute inset-0 bg-gradient-to-br from-white to-gray-50 opacity-100 transition-opacity"></div>
                    <div class="relative z-10"><div class="w-16 h-16 rounded-2xl ${c.bg} flex items-center justify-center mb-6 shadow-sm group-hover:scale-110 transition-transform">${c.icon}</div><h3 class="text-2xl font-bold text-slate-900 mb-2">${c.title}</h3><p class="text-sm text-gray-500 font-medium mb-8 leading-relaxed h-12">${c.subtitle}</p><div class="flex items-center text-sm font-bold text-gray-400 group-hover:text-[#0265DC]">開始估算 →</div></div>`;
                grid.appendChild(btn);
            });
            updateGuide();
        };
    </script>
</body>
</html>
