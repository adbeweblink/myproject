<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pantone è‰²å½©æ¥µé™æŒ‘æˆ° (Pantone Color Challenge)</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Noto Sans TC & Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <!-- LINE LIFF SDK -->
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Inter"', '"Noto Sans TC"', 'sans-serif'],
                        mono: ['"Monaco"', '"Consolas"', 'monospace'],
                    },
                    boxShadow: {
                        'card': '0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24)', 
                        'card-hover': '0 14px 28px rgba(0,0,0,0.25), 0 10px 10px rgba(0,0,0,0.22)',
                        'floating': '0 10px 40px -10px rgba(0,0,0,0.2)',
                    },
                    animation: {
                        'shake': 'shake 0.4s cubic-bezier(.36,.07,.19,.97) both',
                        'pop': 'pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards',
                        'fade-in': 'fadeIn 0.4s ease-out forwards',
                        'slide-up': 'slideUp 0.5s ease-out forwards',
                    },
                    keyframes: {
                        shake: {
                            '0%, 100%': { transform: 'translateX(0)' },
                            '20%': { transform: 'translateX(-6px) rotate(-2deg)' },
                            '40%': { transform: 'translateX(6px) rotate(2deg)' },
                            '60%': { transform: 'translateX(-3px)' },
                            '80%': { transform: 'translateX(3px)' },
                        },
                        pop: {
                            '0%': { transform: 'scale(0.95)', opacity: '0.5' },
                            '100%': { transform: 'scale(1)', opacity: '1' },
                        },
                        fadeIn: {
                            'from': { opacity: '0' },
                            'to': { opacity: '1' },
                        },
                        slideUp: {
                            'from': { opacity: '0', transform: 'translateY(20px)' },
                            'to': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #e0e0e0; 
            -webkit-user-select: none; /* ç¦æ­¢é¸å–ï¼Œæå‡æ‰‹æ©Ÿé»æ“Šé«”é©— */
            user-select: none;
            /* ä¿®æ­£ iOS é»æ“Šé«˜äº®é¡è‰² */
            -webkit-tap-highlight-color: transparent;
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .pantone-card {
            border-radius: 0 !important; 
            background-color: white;
            /* å„ªåŒ–éå ´å‹•ç•«æ›²ç·š */
            transition: transform 0.2s cubic-bezier(0.25, 0.8, 0.25, 1), box-shadow 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .pantone-card-portrait {
            aspect-ratio: 2 / 3; 
        }

        /* æ‰‹æ©Ÿç‰ˆè§¸æ§åé¥‹å„ªåŒ– */
        .pantone-card:active {
            transform: scale(0.98);
        }
    </style>
</head>
<body class="text-slate-900 min-h-screen flex flex-col items-center">

    <!-- Toast / Notification -->
    <div id="toast-container" class="fixed top-6 left-1/2 transform -translate-x-1/2 z-[100] w-max max-w-[90%] pointer-events-none"></div>

    <!-- å¾©æ´» Modal (2026 ä»‹ç´¹) -->
    <div id="revive-modal" class="fixed inset-0 bg-black/80 z-[90] hidden items-center justify-center p-4 backdrop-blur-sm animate-fade-in">
        <div class="bg-white w-full max-w-md overflow-hidden shadow-2xl transform transition-all scale-100 flex flex-col max-h-[90vh]">
            <div id="revive-content" class="overflow-y-auto no-scrollbar">
                <!-- Content injected via JS -->
            </div>
            <div class="p-4 border-t border-gray-100 bg-gray-50 flex-shrink-0">
                <button id="btn-confirm-revive" class="w-full bg-black text-white font-black py-4 text-lg hover:bg-neutral-800 transition-colors flex items-center justify-center gap-2">
                    <span>æ¥é—œæŒ‘æˆ°</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Header (Sticky) -->
    <div class="sticky top-0 z-40 w-full bg-[#e0e0e0]/90 backdrop-blur-md border-b border-gray-300 transition-all duration-300" id="main-header">
        <div class="max-w-2xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-3 cursor-pointer" onclick="location.reload()">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/cc/Pantone_logo.svg/960px-Pantone_logo.svg.png" class="h-6 w-auto object-contain" alt="Pantone Logo">
                <div class="hidden sm:block h-4 w-px bg-gray-400"></div>
                <h1 class="hidden sm:block font-bold text-sm text-gray-600 tracking-wide">COLOR CHALLENGE</h1>
            </div>
            
            <div class="flex items-center gap-4">
                <!-- Level Indicator (Playing Mode) -->
                <div id="level-badge" class="hidden bg-black text-white px-3 py-1 text-sm font-black tracking-widest shadow-md">
                    LV.<span id="level-num">1</span>
                </div>

                <!-- Leaderboard Icon -->
                <button id="btn-header-leaderboard" class="p-2 hover:bg-gray-300 transition-colors text-gray-700 active:scale-95 transform" title="æ’è¡Œæ¦œ">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div id="app" class="w-full max-w-3xl px-4 py-8 flex-grow flex flex-col relative">
        <!-- Content injected via JS -->
    </div>

    <!-- Footer -->
    <footer class="w-full text-center py-6 text-gray-500 text-xs font-medium">
        Â© Pantone Color Challenge. Unofficial Fan Game.
    </footer>

    <!-- Logic -->
    <script>
        // --- Configuration & Data ---
        const LOGO_URL = "https://upload.wikimedia.org/wikipedia/commons/thumb/c/cc/Pantone_logo.svg/960px-Pantone_logo.svg.png";
        const LIFF_ID = "2008592497-pmWyN9om";
        const BOTBONNIE_URL = "https://r.botbonnie.com/P0LF4";
        const SHARE_IMAGE_URL = "https://adbeweblink.github.io/myproject/pantone.jpg";
        const KEY_CAMPAIGN_VISUAL_URL = "https://adbeweblink.github.io/myproject/pantone/Key%20Campaign%20Visual%201.png";
        
        // Updated Data Structure: Precise Translations and Descriptions
        const PANTONE_YEARS = [
            {
                year: 2026,
                name: "Cloud Dancer",
                nameCN: "é›²ä¸Šèˆç™½",
                code: "11-4201 TCX",
                hex: "#F0EFE9",
                img: "https://adbeweblink.github.io/myproject/COYhistoricalchipimage/2026PANTONE11-4201CloudDancer.png",
                desc: "é›²ä¸Šèˆç™½çŒ¶å¦‚ç©ºç™½ç•«å¸ƒï¼Œè±¡å¾µæˆ‘å€‘å°å…¨æ–°é–‹å§‹çš„åš®å¾€ã€‚å¸ä¸‹é™³èˆŠæ€ç¶­çš„å±¤å±¤æŸç¸›ï¼Œæˆ‘å€‘ç‚ºå…¨æ–°æ–¹å¼æ•é–‹å¤§é–€ã€‚é€™æ˜¯ä¸€æ¬¾è¼•ç›ˆé€šé€çš„ç™½è‰²èª¿ï¼Œç‚ºå‰µæ„é–‹é—¢å»£é—Šç©ºé–“ï¼Œè®“æƒ³åƒåŠ›è‡ªç”±æ¼«éŠï¼Œä½¿æ–°ç©è¦‹è§£èˆ‡å¤§è†½æ§‹æ€å¾—ä»¥æ¹§ç¾ã€å…·è±¡æˆå½¢ã€‚"
            },
            {
                year: 2025,
                name: "Mocha Mousse",
                nameCN: "æ‘©å¡æ…•æ–¯",
                code: "17-1230 TCX",
                hex: "#96786A",
                img: "https://adbeweblink.github.io/myproject/COYhistoricalchipimage/2025PANTONE17-1230MochaMousse.png", 
                desc: "Mocha Mousse æ˜¯ä¸€ç¨®æº«æš–çš„æ£•è‰²èª¿ï¼Œè˜Šå«è‘—å…§åœ¨çš„è±å¯Œè³ªæ„Ÿï¼Œè®“äººè¯æƒ³åˆ°å¯å“¥ã€å·§å…‹åŠ›å’Œå’–å•¡çš„ç¾å‘³å“è³ªï¼Œæ»¿è¶³æˆ‘å€‘å°èˆ’é©çš„æ¸´æœ›ã€‚"
            },
            { 
                year: 2024, name: "Peach Fuzz", nameCN: "æŸ”å’Œæ¡ƒ", code: "13-1023 TCX", hex: "#FFBE98", 
                img: "https://adbeweblink.github.io/myproject/COYhistoricalchipimage/2024PANTONE13-1032PeachFuzz.png",
                desc: "Peach Fuzz è¡¨ç¾å‡ºæˆ‘å€‘å°ç…§é¡§è‡ªæˆ‘èˆ‡ä»–äººçš„æ¸´æœ›ï¼Œé€™æ˜¯æŸ”è»Ÿæº«å’Œçš„èœœæ¡ƒè‰²è‰²èª¿ï¼Œä»¥æ¥µå…·åŒ…å®¹åŠ›çš„ç²¾ç¥è±å¯Œäº†èº«å¿ƒéˆã€‚" 
            },
            { 
                year: 2023, name: "Viva Magenta", nameCN: "éå‡¡æ´‹ç´…", code: "18-1750 TCX", hex: "#BB2649", 
                img: "https://adbeweblink.github.io/myproject/COYhistoricalchipimage/2023PANTONE18-1750VivaMagenta.png",
                desc: "Viva Magenta æ˜¯ä¸€å€‹å‹‡æ•¢ç„¡ç•ã€ä»¤äººæ‚¸å‹•çš„è‰²å½©ï¼Œç¹èŒ‚çš„æ„è±¡æ´‹æº¢è‘—æ„‰å¿«æ¨‚è§€çš„æ­¡æ…¶æ°£æ¯ï¼Œæç¹ªå‡ºæ–°çš„ç¯‡ç« ã€‚" 
            },
            { 
                year: 2022, name: "Very Peri", nameCN: "é•·æ˜¥èŠ±è—", code: "17-3938 TCX", hex: "#6667AB", 
                img: "https://adbeweblink.github.io/myproject/COYhistoricalchipimage/2022PANTONE17-3938VeryPeri.png",
                desc: "Very Peri å«æ‹¬è—è‰²çš„ç‰¹è³ªï¼ŒåŒæ™‚åˆä¿æœ‰ç´«ç´…çš„åŸºèª¿ï¼Œå±•ç¾ä¸€ç¨®æ©Ÿéˆã€æ„‰æ‚…çš„æ…‹åº¦èˆ‡å……æ»¿æ´»åŠ›çš„é¢¨è²Œï¼Œæ¿€ç™¼å‹‡æ°£åè¶³çš„å‰µæ„èˆ‡æƒ³åƒè±å¯Œçš„è¡¨ç¾ã€‚" 
            },
            { 
                year: 2021, name: "Ultimate Gray", nameCN: "æ¥µè‡´ç°", code: "17-5104 TCX", hex: "#939597", 
                img: "https://adbeweblink.github.io/myproject/COYhistoricalchipimage/2021PANTONE17-5104UltimateGray.png",
                desc: "Ultimate Gray è±¡å¾µå …å®šå¯é çš„ç´ è³ªï¼Œæ†ä¹…ä¸æ¸ï¼Œæä¾›å …å¯¦çš„åŸºç¤ã€‚" 
            },
            { 
                year: 2021, name: "Illuminating", nameCN: "äº®éº—é»ƒ", code: "13-0647 TCX", hex: "#F5DF4D", 
                img: "https://adbeweblink.github.io/myproject/COYhistoricalchipimage/2021PANTONE13-0647Illuminating.png",
                desc: "Illuminating æ˜¯æ˜äº®å¿«æ´»ï¼Œæ´‹æº¢æ´»åŠ›ï¼Œæ³¨å…¥äº†å¤ªé™½èƒ½é‡çš„æš–é»ƒè‰²èª¿ã€‚" 
            },
            { 
                year: 2020, name: "Classic Blue", nameCN: "ç¶“å…¸è—", code: "19-4052 TCX", hex: "#0F4C81", 
                img: "https://adbeweblink.github.io/myproject/COYhistoricalchipimage/2020PANTONE19-4052ClassicBlue.png",
                desc: "Classic Blue æ˜¯ä¸€å€‹æ°¸æ†ä¸æœ½çš„è—è‰²èª¿ï¼Œç°¡ç´„ä¸­æµéœ²å„ªé›…ã€‚å°±åƒæ˜¯è–„æš®æ™‚çš„å¤©ç©ºï¼Œå¼•äººæ·±æ€ã€ä»¤äººå®‰å¿ƒã€‚" 
            },
            { 
                year: 2019, name: "Living Coral", nameCN: "æ´»çŠç‘šæ©˜", code: "16-1546 TCX", hex: "#FF6F61", 
                img: "https://adbeweblink.github.io/myproject/COYhistoricalchipimage/2019PANTONE16-1546LivingCoral.png",
                desc: "Living Coral ä»£è¡¨è‘—ç¾ä»£ç”Ÿæ´»çš„å¤šæ–¹èåˆï¼Œæ˜¯åœ¨å‘¨é­è‡ªç„¶ç’°å¢ƒä¸­å‡ºç¾çš„æ»‹é¤Šé¡è‰²ï¼ŒåŒæ™‚ä¹Ÿæ˜¯ç¤¾ç¾¤åª’é«”è£¡ç”Ÿå‹•å‘ˆç¾çš„è‰²å½©ã€‚" 
            },
            { 
                year: 2018, name: "Ultra Violet", nameCN: "ç´«å¤–å…‰", code: "18-3838 TCX", hex: "#5F4B8B", 
                img: "https://adbeweblink.github.io/myproject/COYhistoricalchipimage/2018PANTONE18-3838UltraViolet.png",
                desc: "Ultra Violet æ˜¯ä¸€å€‹å¯Œæ–¼å‰µé€ æ€§èˆ‡æƒ³åƒåŠ›çš„ç´«å¤–å…‰è‰²ç…§äº®é€šå¾€æœªä¾†çš„é“è·¯ã€‚" 
            },
            { 
                year: 2017, name: "Greenery", nameCN: "è‰æœ¨ç¶ ", code: "15-0343 TCX", hex: "#88B04B", 
                img: "https://adbeweblink.github.io/myproject/COYhistoricalchipimage/2017PANTONE15-0343Greenery.png",
                desc: "Greenery æ˜¯ä¸€å€‹ä»£è¡¨åˆæ˜¥æ™‚ç¯€è¬ç‰©å¾©ç”¦ã€æ¬£æ¬£å‘æ¦®çš„é¡è‰²ï¼Œæ¸…æ–°è€Œå……æ»¿æ´»åŠ›ã€‚" 
            },
            { 
                year: 2016, name: "Serenity", nameCN: "å¯§éœç²‰è—", code: "15-3919 TCX", hex: "#91A8D0", 
                img: "https://adbeweblink.github.io/myproject/COYhistoricalchipimage/2016PANTONE15-3919Serenity.png",
                desc: "Serenity åƒæ˜¯æˆ‘å€‘é ­ä¸Šå¯¬é—Šçš„è—å¤©ä¸€èˆ¬çš„å¯§éœè—ï¼Œåœ¨æ’«æ…°ä¸­å¸¶æœ‰å†·éœçš„æ•ˆæœï¼Œå³ä½¿åœ¨å‹•ç›ªä¸å®‰çš„æ™‚ä»£éƒ½å¸¶ä¾†ç·©å’Œèˆ‡æ”¾é¬†çš„æ„Ÿè¦ºã€‚" 
            },
            { 
                year: 2016, name: "Rose Quartz", nameCN: "ç«ç‘°çŸ³è‹±ç²‰", code: "13-1520 TCX", hex: "#F7CAC9", 
                img: "https://adbeweblink.github.io/myproject/COYhistoricalchipimage/2016PANTONE13-1520RoseQuartz.png",
                desc: "Rose Quartz æ˜¯ä¸€å€‹å‹•äººçš„æº«æŸ”è‰²èª¿ï¼Œå‚³é”æ„›å¿ƒèˆ‡ä¸€ç¨®ç©©å®šæ„Ÿã€‚" 
            },
            { 
                year: 2015, name: "Marsala", nameCN: "ç‘ªè–©æ‹‰é…’ç´…", code: "18-1438 TCX", hex: "#964F4C", 
                img: "https://adbeweblink.github.io/myproject/COYhistoricalchipimage/2015PANTONE18-1438Marsala.png",
                desc: "Marsala è±å¯Œæˆ‘å€‘çš„ç²¾ç¥ã€è‚‰é«”èˆ‡éˆé­‚ï¼Œæµéœ²ä¿¡å¿ƒèˆ‡å …å®šã€‚" 
            },
            { 
                year: 2014, name: "Radiant Orchid", nameCN: "ç’€ç’¨ç´«è˜­èŠ±", code: "18-3224 TCX", hex: "#B565A7", 
                img: "https://adbeweblink.github.io/myproject/COYhistoricalchipimage/2014PANTONE18-3224RadiantOrchid.png",
                desc: "Radiant Orchid å–šèµ·è‡ªä¿¡ï¼Œæ•£ç™¼å‡ºæ¥µå¤§çš„å–œæ‚…ã€æ„›èˆ‡å¥åº·ã€‚" 
            },
            { 
                year: 2013, name: "Emerald", nameCN: "ç¿¡ç¿ ç¶ ", code: "17-5641 TCX", hex: "#009473", 
                img: "https://adbeweblink.github.io/myproject/COYhistoricalchipimage/2013PANTONE17-5641Emerald.png",
                desc: "Emerald é®®æ˜å‹•äººã€ç¶ æ„ç›ç„¶çš„ç¿¡ç¿ ç¶ å‰‡èƒ½å•Ÿç™¼æ·±åˆ»è¦‹è§£ï¼Œå¢é€²å¹³è¡¡èˆ‡å’Œè«§ï¼Œé€²ä¸€æ­¥æå‡æˆ‘å€‘çš„å¹¸ç¦æ„Ÿã€‚" 
            },
            { 
                year: 2012, name: "Tangerine Tango", nameCN: "æ¢æˆˆæ©˜", code: "17-1463 TCX", hex: "#DD4124", 
                img: "https://adbeweblink.github.io/myproject/COYhistoricalchipimage/2012PANTONE17-1463TangerineTango.png",
                desc: "Tangerine Tango æ˜¯ç”Ÿæ°£å‹ƒå‹ƒã€åç´…çš„æ©˜è‰²ï¼Œç‚ºæˆ‘å€‘æä¾›é‡æ–°å……é›»ã€ç¹¼çºŒå‰é€²æ‰€éœ€çš„é£½æ»¿èƒ½é‡ã€‚" 
            },
            { 
                year: 2011, name: "Honeysuckle", nameCN: "å¿å†¬ç´…", code: "18-2120 TCX", hex: "#D65076", 
                img: "https://adbeweblink.github.io/myproject/COYhistoricalchipimage/2011PANTONE18-2120Honeysuckle.png",
                desc: "Honeysuckle æ˜¯ä¸€å€‹ä»£è¡¨å‹‡æ•¢ã€è‡ªä¿¡ã€é‡è¦çš„è‰²å½©ã€‚" 
            },
            { 
                year: 2010, name: "Turquoise", nameCN: "æ¾çŸ³ç¶ ", code: "15-5519 TCX", hex: "#45B5AA", 
                img: "https://adbeweblink.github.io/myproject/COYhistoricalchipimage/2010PANTONE15-5519Turquoise.png",
                desc: "Turquoise å•Ÿç™¼æ€æƒ³ï¼Œç†±å¸¶æ°´åŸŸå’Œèˆ’é©é€ƒé›¢ä¸–ç•Œçš„æ—¥å¸¸ç…©æƒ±ï¼ŒåŒæ™‚æ¢å¾©æˆ‘å€‘çš„å¹¸ç¦æ„Ÿã€‚" 
            },
            { 
                year: 2009, name: "Mimosa", nameCN: "å«ç¾è‰é»ƒ", code: "14-0848 TCX", hex: "#EFC050", 
                img: "https://adbeweblink.github.io/myproject/COYhistoricalchipimage/2009PANTONE14-0848Mimosa.png",
                desc: "Mimosa è±¡å¾µè‘—å¤ªé™½çš„æº«æš–å’Œæ»‹é¤Šçš„å“è³ªï¼Œæˆ‘å€‘ä½œç‚ºäººé¡çš„å±¬æ€§è‡ªç„¶è¢«å¸å¼•ä¾†ä¿è­‰ã€‚" 
            },
            { 
                year: 2008, name: "Blue Iris", nameCN: "é³¶å°¾è—", code: "18-3943 TCX", hex: "#5A5B9F", 
                img: "https://adbeweblink.github.io/myproject/COYhistoricalchipimage/2008PANTONE18-3943BlueIris.png",
                desc: "Blur Iris çµåˆäº†ç©©å®šå’Œå¹³éœçš„ä¸€é¢ï¼Œæ»¿è¶³äº†åœ¨ä¸€å€‹è¤‡é›œçš„ä¸–ç•Œï¼ŒåŒæ™‚å¢åŠ äº†ä¸€å€‹ç¥ç§˜å’Œèˆˆå¥®çš„æš—ç¤ºçš„éœ€è¦ã€‚" 
            },
            { 
                year: 2007, name: "Chili Pepper", nameCN: "è¾£æ¤’ç´…", code: "19-1557 TCX", hex: "#9B1B30", 
                img: "https://adbeweblink.github.io/myproject/COYhistoricalchipimage/2007PANTONE19-1557ChiliPepper.png",
                desc: "Chili Pepper æ„å‘³è‘—ä¸€ç¨®å¤–å‘ã€è‡ªä¿¡ã€è¨­è¨ˆç²¾ç¥çš„æ…‹åº¦ã€‚" 
            },
            { 
                year: 2006, name: "Sand Dollar", nameCN: "æ²™å¹£è¤", code: "13-1106 TCX", hex: "#DECDBE", 
                img: "https://adbeweblink.github.io/myproject/COYhistoricalchipimage/2006PANTONE13-1106SandDollar.png",
                desc: "Sand Dollar æ˜¯ä¸€ç¨®æº«æš–ã€æŸ”å’Œçš„ç±³è‰²èª¿ï¼Œä»£è¡¨äº†è¿½æ±‚å¯§éœã€ç°¡ç´„å’Œè‡ªç„¶çš„ç”Ÿæ´»æ–¹å¼ã€‚" 
            },
            { 
                year: 2005, name: "Blue Turquoise", nameCN: "è—ç¶ æ¾çŸ³", code: "15-5217 TCX", hex: "#53B0AE", 
                img: "https://adbeweblink.github.io/myproject/COYhistoricalchipimage/2005PANTONE15-5217BlueTurquoise.png",
                desc: "Blue Turquoise å¾æµ·æ´‹è‰²èª¿æ±²å–éˆæ„Ÿï¼Œå¸¶ä¾†æ²‰éœèˆ‡å®‰å¿ƒçš„æ„Ÿè¦ºã€‚" 
            },
            { 
                year: 2004, name: "Tigerlily", nameCN: "è™çš®ç™¾åˆæ©˜", code: "17-1456 TCX", hex: "#E2583E", 
                img: "https://adbeweblink.github.io/myproject/COYhistoricalchipimage/2004PANTONE17-1456Tigerlily.png",
                desc: "Tigerlily ç‚ºæˆ‘å€‘æ³¨å…¥èƒ½é‡ã€æ¢å¾©ç²¾ç¥ï¼Œä¸¦ä»¥å¤§è†½é®®æ˜çš„å§¿æ…‹å¸å¼•æˆ‘å€‘çš„æ³¨æ„ã€‚" 
            },
            { 
                year: 2003, name: "Aqua Sky", nameCN: "æ°´è‰²å¤©ç©º", code: "14-4811 TCX", hex: "#7BC4C4", 
                img: "https://adbeweblink.github.io/myproject/COYhistoricalchipimage/2003PANTONE14-4811AquaSky.png",
                desc: "Aqua Sky é€éæŸ”å’Œçš„è—ç¶ è‰²èª¿ï¼Œå‚³é”éœè¬çš„è¨Šæ¯ã€‚" 
            },
            { 
                year: 2002, name: "True Red", nameCN: "æ­£ç´…", code: "19-1664 TCX", hex: "#BF1932", 
                img: "https://adbeweblink.github.io/myproject/COYhistoricalchipimage/2002PANTONE19-1664TrueRed.png",
                desc: "True Red å……æ»¿æ´»åŠ›ã€ç†±æƒ…ã€åŠ›é‡èˆ‡è‡ªä¿¡ã€‚" 
            },
            { 
                year: 2001, name: "Fuchsia Rose", nameCN: "æ¡ƒç´…ç«ç‘°", code: "17-2031 TCX", hex: "#C74375", 
                img: "https://adbeweblink.github.io/myproject/COYhistoricalchipimage/2001PANTONE17-2031FuchsiaRose.png",
                desc: "Fuchsia Rose æ˜¯æ‰åˆç²‰ç´…èª¿çš„ç´«è‰²ï¼Œç†±æƒ…ã€å¼·çƒˆè€Œåˆºæ¿€ï¼Œå»ä»ä¿æœ‰æº«æš–è¦ªåˆ‡çš„æ„Ÿè¦ºã€‚" 
            },
            { 
                year: 2000, name: "Cerulean", nameCN: "è”šè—", code: "15-4020 TCX", hex: "#98B2D1", 
                img: "https://adbeweblink.github.io/myproject/COYhistoricalchipimage/2000PANTONE15-4020Cerulean.png",
                desc: "Cerulean ä»£è¡¨è‘—åƒç¦§å¹´çš„å¤©ç©ºè‰²å½©ã€‚" 
            },
        ];

        // --- Game State ---
        const state = {
            view: 'home', // home, intro, playing, gameover, leaderboard
            level: 1,
            currentBase: PANTONE_YEARS[0],
            introBase: null, // For year selection viewing
            oddColor: "",
            oddIndex: 0,
            wrongIndex: -1, 
            showFeedback: false, 
            hasRevived: false,
            pendingPointsClaim: false, // NEW: Track if player has earned points reward but not claimed yet
            failedDetails: { baseHex: '', oddHex: '', difference: 0 }
        };

        // --- Helper Functions ---
        const hexToRgb = (hex) => {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? { r: parseInt(result[1], 16), g: parseInt(result[2], 16), b: parseInt(result[3], 16) } : { r: 0, g: 0, b: 0 };
        };

        const rgbToHex = (r, g, b) => {
            return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1).toUpperCase();
        };

        const getColorDifference = (hex1, hex2) => {
            const rgb1 = hexToRgb(hex1);
            const rgb2 = hexToRgb(hex2);
            const diffSq = Math.pow(rgb1.r - rgb2.r, 2) + Math.pow(rgb1.g - rgb2.g, 2) + Math.pow(rgb1.b - rgb2.b, 2);
            const maxDiff = 441.67;
            return ((Math.sqrt(diffSq) / maxDiff) * 100).toFixed(2);
        };

        const generateVariantColor = (baseHex, level) => {
            const rgb = hexToRgb(baseHex);
            let difficulty = Math.max(1.8, 30 - (level * 1.5)); 
            
            const change = (val) => {
                const direction = Math.random() > 0.5 ? 1 : -1;
                let newVal = val + (difficulty * direction);
                if (newVal > 255) newVal = val - difficulty;
                if (newVal < 0) newVal = val + difficulty; 
                if (Math.abs(newVal - val) < 3) newVal = val + (direction * 5); 
                return Math.floor(Math.max(0, Math.min(255, newVal)));
            };

            return rgbToHex(change(rgb.r), change(rgb.g), change(rgb.b));
        };

        const getRankTitle = (level) => {
            if (level < 5) return "è‰²å½©å­¸å¾’";
            if (level < 10) return "è¨­è¨ˆåŠ©ç†";
            if (level < 15) return "è³‡æ·±è¨­è¨ˆå¸«";
            if (level < 20) return "è—è¡“ç¸½ç›£";
            if (level < 30) return "å°åˆ·å» å¸«å‚…";
            return "çµ•å°è‰²æ„Ÿç¥äºº";
        };

        const showToast = (message, type = 'success') => {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            const bgClass = type === 'error' ? 'bg-red-500' : 'bg-black';
            toast.className = `${bgClass} text-white px-6 py-3 shadow-2xl flex items-center gap-3 animate-slide-up mb-2 mx-auto w-fit z-50 rounded`;
            toast.innerHTML = `<span class="font-bold text-sm tracking-wide">${message}</span>`;
            
            container.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 2000);
        };

        // --- Local Storage ---
        const SCORE_KEY = 'pantone_game_scores_v2';
        const getScores = () => {
            try { return JSON.parse(localStorage.getItem(SCORE_KEY)) || []; } catch { return []; }
        };
        const saveScore = (score) => {
            const scores = getScores();
            scores.push({ score, rankTitle: getRankTitle(score + 1), date: new Date().toLocaleDateString() });
            scores.sort((a, b) => b.score - a.score);
            localStorage.setItem(SCORE_KEY, JSON.stringify(scores.slice(0, 5)));
        };

        // --- Core Game Logic ---
        const startRound = (specificBase = null) => {
            const base = specificBase || PANTONE_YEARS[Math.floor(Math.random() * PANTONE_YEARS.length)];
            state.currentBase = base;
            state.oddColor = generateVariantColor(base.hex, state.level);
            state.oddIndex = Math.floor(Math.random() * 4);
            state.wrongIndex = -1;
            state.showFeedback = false;
            render();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        const startRandomGame = () => {
            state.level = 1;
            state.hasRevived = false;
            state.pendingPointsClaim = false; // Reset claim status
            state.view = 'playing';
            startRound();
        };

        const startGameFromIntro = () => {
            state.level = 1;
            state.hasRevived = false;
            state.pendingPointsClaim = false; // Reset claim status
            state.view = 'playing';
            startRound(state.introBase);
        };

        const handleCardClick = (index) => {
            if (state.showFeedback || state.wrongIndex !== -1) return; 

            if (index === state.oddIndex) {
                state.level++;
                if (navigator.vibrate) navigator.vibrate(50);
                
                const card = document.querySelector(`[data-card-index="${index}"]`);
                if(card) {
                    const overlay = document.createElement('div');
                    overlay.className = "absolute inset-0 z-20 flex items-center justify-center animate-pop";
                    overlay.innerHTML = `<div class="bg-green-500/90 text-white p-3 shadow-lg rounded-full"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg></div>`;
                    card.appendChild(overlay);
                }

                setTimeout(() => startRound(), 400); 
            } else {
                state.failedDetails = {
                    baseHex: state.currentBase.hex,
                    oddHex: state.oddColor,
                    difference: getColorDifference(state.currentBase.hex, state.oddColor)
                };

                if (!state.hasRevived) {
                    // Waiting for potential revive
                } else {
                    saveScore(state.level - 1);
                }

                if (navigator.vibrate) navigator.vibrate([100, 50, 100]);
                state.wrongIndex = index; 
                state.showFeedback = true; 
                render(); 
                
                setTimeout(() => {
                    state.view = 'gameover';
                    render();
                }, 1200);
            }
        };

        // --- Revive Logic ---
        const openReviveModal = () => {
            const modal = document.getElementById('revive-modal');
            const content = document.getElementById('revive-content');
            const p2026 = PANTONE_YEARS.find(p => p.year === 2026);

            content.innerHTML = `
                <div class="bg-white">
                    <div class="h-64 w-full relative" style="background-color: ${p2026.hex}">
                        <div class="absolute top-4 left-4 bg-black/90 text-white text-[10px] px-3 py-1.5 uppercase tracking-wider font-bold">PANTONE 2026 COLOR OF THE YEAR</div>
                    </div>
                    <div class="p-8">
                         <img src="${LOGO_URL}" class="h-6 mb-6 opacity-80" />
                         <h2 class="text-4xl font-black text-gray-900 mb-2 leading-none">${p2026.name}</h2>
                         <h3 class="text-xl font-bold text-gray-500 mb-6">${p2026.nameCN} <span class="text-sm font-mono text-gray-300 ml-2">${p2026.code}</span></h3>
                         <p class="text-gray-600 leading-relaxed text-justify mb-4 text-sm font-medium">${p2026.desc}</p>
                         <div class="bg-gray-100 p-4 text-xs text-gray-500 font-mono">
                            ç¾åœ¨ï¼Œå¸¶è‘—é€™ä»½è‰²å½©çš„èƒ½é‡é‡è¿”æŒ‘æˆ°å§ï¼
                         </div>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        };

        const confirmRevive = () => {
            const modal = document.getElementById('revive-modal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            
            // Execute Revive
            state.hasRevived = true;
            state.view = 'playing';
            startRound(state.currentBase);
        };

        // BotBonnie Share Revive Handler
        const handleShareRevive = () => {
            // MOCK FOR PREVIEW
            if (typeof liff === 'undefined' || !liff.isInClient()) {
                console.warn("âš ï¸ Preview Mode: Simulating Share Success");
                showToast("é è¦½æ¨¡å¼ï¼šæ¨¡æ“¬åˆ†äº«æˆåŠŸï¼(æ­£å¼ç’°å¢ƒéœ€åœ¨ LINE é–‹å•Ÿ)");
                state.pendingPointsClaim = true;
                setTimeout(() => { confirmRevive(); }, 1000);
                return;
            }

            if (!liff.isInClient()) {
                showToast("è«‹åœ¨ LINE App å…§é–‹å•Ÿä»¥ä½¿ç”¨å¥½å‹åˆ†äº«åŠŸèƒ½", "error");
                return;
            }

            if (!liff.isLoggedIn()) {
                liff.login();
                return;
            }

            if (!liff.isApiAvailable('shareTargetPicker')) {
                showToast("æ‚¨çš„ LINE ç‰ˆæœ¬ä¸æ”¯æ´åˆ†äº«åŠŸèƒ½ï¼Œè«‹æ›´æ–°", "error");
                return;
            }

            const passedLevels = Math.max(0, state.level - 1);
            const message = [
                {
                    "type": "flex",
                    "altText": "Pantone è‰²å½©æ¥µé™æŒ‘æˆ°ï¼šçœ¼åŠ›å¤§è€ƒé©—",
                    "contents": {
                        "type": "bubble",
                        "hero": {
                            "type": "image",
                            "url": SHARE_IMAGE_URL,
                            "size": "full",
                            "aspectRatio": "9:16", 
                            "aspectMode": "cover",
                            "action": {
                                "type": "uri",
                                "uri": `https://liff.line.me/${LIFF_ID}`
                            }
                        },
                        "body": {
                            "type": "box",
                            "layout": "vertical",
                            "contents": [
                                {
                                    "type": "text",
                                    "text": "Pantone è‰²å½©æ¥µé™æŒ‘æˆ°",
                                    "weight": "bold",
                                    "size": "xl",
                                    "wrap": true
                                },
                                {
                                    "type": "text",
                                    "text": `æˆ‘ç²å¾—äº† ${passedLevels} åˆ†ï¼ä½ èƒ½è´éæˆ‘å—ï¼Ÿ`,
                                    "margin": "md",
                                    "size": "md",
                                    "wrap": true,
                                    "color": "#666666"
                                }
                            ]
                        },
                        "footer": {
                            "type": "box",
                            "layout": "vertical",
                            "spacing": "sm",
                            "contents": [
                                {
                                    "type": "button",
                                    "style": "primary",
                                    "color": "#000000",
                                    "height": "sm",
                                    "action": {
                                        "type": "uri",
                                        "label": "ç«‹å³æŒ‘æˆ°",
                                        "uri": `https://liff.line.me/${LIFF_ID}`
                                    }
                                }
                            ],
                            "flex": 0
                        }
                    }
                }
            ];

            liff.shareTargetPicker(message)
                .then(function (res) {
                    if (res) {
                        state.pendingPointsClaim = true;
                        showToast("åˆ†äº«æˆåŠŸï¼å¾©æ´»ç¹¼çºŒæŒ‘æˆ°ï¼(éŠæˆ²çµæŸå¾Œå¯é ˜å–é»æ•¸)");
                        setTimeout(() => { confirmRevive(); }, 500);
                    } else {
                        showToast("éœ€å®Œæˆåˆ†äº«æ‰èƒ½æ¥é—œå–”ï¼", "error");
                    }
                })
                .catch(function (error) {
                    console.log("something wrong happen", error);
                    showToast("åˆ†äº«å¤±æ•—ï¼Œè«‹ç¢ºèª LINE æ¬Šé™è¨­å®š", "error");
                });
        };

        const handleClaimPoints = () => {
            if (typeof liff === 'undefined' || !liff.isInClient()) {
                 window.open(BOTBONNIE_URL, '_blank');
                 return;
            }
             liff.openWindow({
                url: BOTBONNIE_URL,
                external: true
            });
        };

        // --- Render Functions ---
        
        // 1. Home View (Updated with new layout and images)
        const renderHome = () => {
            // Split 2026 and others. 
            // Data is already sorted 2026 -> 2000 in the updated array.
            const p2026 = PANTONE_YEARS[0]; // 2026 is the first one
            const otherYears = PANTONE_YEARS.slice(1); // 2025 onwards

            // Template using IMG tag instead of background-color div
            const templatePortrait = (p) => `
                <div data-action="intro" data-year="${p.year}" data-name="${p.name}" 
                     class="pantone-card pantone-card-portrait bg-white shadow-card hover:shadow-card-hover cursor-pointer group flex flex-col transform hover:-translate-y-1 relative overflow-hidden">
                    
                    <img src="${p.img}" loading="lazy" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105" alt="${p.name}">
                    
                    <!-- Year Label -->
                    <div class="absolute top-3 left-3 bg-white/80 backdrop-blur-sm text-black text-[10px] px-2 py-0.5 font-bold uppercase tracking-wider shadow-sm z-10">
                        ${p.year}
                    </div>
                    
                    <!-- Hover Overlay (Optional, for better UX) -->
                    <div class="absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                </div>
            `;

            return `
                <div class="animate-fade-in pb-10 max-w-5xl mx-auto">
                    <!-- Hero Section -->
                    <div class="text-center mb-10 mt-4">
                        <h2 class="text-4xl md:text-6xl font-black text-slate-800 tracking-tighter mb-4">è‰²å½©æ¥µé™æŒ‘æˆ°</h2>
                        <div class="w-16 h-1 bg-black mx-auto mb-4"></div>
                        <p class="text-slate-500 font-medium tracking-wide">PANTONE COLOR CHALLENGE</p>
                    </div>

                    <!-- Start Button -->
                    <button id="btn-random" class="w-full max-w-md mx-auto bg-black text-white p-5 shadow-xl hover:bg-neutral-800 transition-all flex items-center justify-between group mb-16 relative overflow-hidden active:scale-95">
                        <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700"></div>
                        <div class="flex flex-col text-left">
                            <span class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-1">IMMEDIATE START</span>
                            <span class="text-xl font-black flex items-center gap-2">
                                éš¨æ©Ÿé–‹å§‹æŒ‘æˆ° 
                                <span class="bg-white text-black text-xs px-2 py-0.5 font-bold">PLAY</span>
                            </span>
                        </div>
                        <svg class="w-6 h-6 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                    </button>

                    <!-- Section Header -->
                    <div class="flex items-center gap-4 mb-8">
                        <div class="h-4 w-1 bg-black"></div>
                        <span class="text-lg font-black text-black uppercase tracking-tight">é¸æ“‡ PANTONE å¹´åº¦ä»£è¡¨è‰²</span>
                    </div>

                    <!-- 2026 Layout Split: Left (Card) | Right (Key Visual) -->
                    <div class="grid grid-cols-2 gap-4 md:gap-8 mb-8">
                        <!-- Left: 2026 Card -->
                        ${templatePortrait(p2026)}
                        
                        <!-- Right: Key Visual -->
                        <div class="pantone-card pantone-card-portrait shadow-card hover:shadow-card-hover group relative overflow-hidden">
                             <img src="${KEY_CAMPAIGN_VISUAL_URL}" class="w-full h-full object-cover object-[35%_center] transition-transform duration-700 group-hover:scale-105" alt="2026 Key Visual">
                             <div class="absolute bottom-4 left-4 right-4 bg-black/60 backdrop-blur-md p-3 text-white opacity-0 group-hover:opacity-100 transition-opacity">
                                <div class="text-[10px] font-bold uppercase tracking-widest mb-1">Campaign</div>
                                <div class="font-bold text-sm">2026 Visual Identity</div>
                             </div>
                        </div>
                    </div>

                    <!-- Past Years Grid (Portrait) -->
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-8">
                        ${otherYears.map(p => templatePortrait(p)).join('')}
                    </div>
                </div>
            `;
        };

        // 2. Intro View (Detail Page)
        const renderIntro = () => {
            const p = state.introBase || state.currentBase;
            // Force HEX color for Intro view as requested
            const bgStyle = `background-color: ${p.hex}`;

            return `
                <div class="animate-fade-in flex flex-col h-full max-w-md mx-auto">
                    <div class="bg-white shadow-2xl overflow-hidden relative flex-grow flex flex-col">
                        <button id="btn-intro-close" class="absolute top-4 right-4 z-20 bg-white/50 backdrop-blur hover:bg-white text-black rounded-full p-2 transition-all active:scale-90 shadow-sm">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                        </button>
                        
                        <div class="h-[50vh] w-full relative" style="${bgStyle}">
                            <div class="absolute bottom-0 left-0 w-full h-32 bg-gradient-to-t from-black/20 to-transparent pointer-events-none"></div>
                        </div>
                        
                        <div class="p-8 flex-1 flex flex-col bg-white">
                            <img src="${LOGO_URL}" class="h-6 w-auto object-contain object-left mb-8 opacity-80" alt="Pantone">
                            
                            <h1 class="text-5xl font-black text-slate-900 mb-2 leading-none tracking-tight">${p.name}</h1>
                            <div class="flex flex-col mb-8 border-l-4 border-gray-900 pl-4 py-1">
                                <h2 class="text-2xl font-bold text-slate-500">${p.nameCN}</h2>
                                <span class="font-mono font-bold text-slate-300 text-sm mt-1">${p.code}</span>
                            </div>
                            
                            <div class="prose prose-sm text-slate-600 font-medium leading-relaxed text-justify mb-8">
                                ${p.desc}
                            </div>

                            <button id="btn-start-challenge" class="mt-auto w-full bg-black text-white py-5 font-black text-xl hover:bg-neutral-800 transition-all shadow-lg active:scale-[0.98] flex items-center justify-center gap-3">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                                START CHALLENGE
                            </button>
                        </div>
                    </div>
                </div>
            `;
        };

        // 3. Playing View - æ›´æ–°ç‚ºæ¨™æº–è‰²ç¥¨æ’ç‰ˆä¸”ç„¡ä¸­æ–‡
        const renderPlaying = () => {
            let cardsHtml = '';
            for (let i = 0; i < 4; i++) {
                const isOdd = i === state.oddIndex;
                const isWrong = i === state.wrongIndex;
                const displayHex = isOdd ? state.oddColor : state.currentBase.hex;
                
                let overlay = '';
                if (state.showFeedback) {
                     if (isOdd) {
                        overlay = `<div class="absolute inset-0 z-20 flex items-center justify-center bg-black/10"><div class="bg-white text-black px-4 py-2 font-bold shadow-lg text-xs animate-pop">ANSWER</div></div>`;
                     } else if (isWrong) {
                         overlay = `<div class="absolute inset-0 z-20 flex items-center justify-center bg-red-500/20"><svg class="w-12 h-12 text-red-600 animate-pop" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></div>`;
                     }
                }

                cardsHtml += `
                    <div data-card-index="${i}" class="pantone-card pantone-card-portrait bg-white shadow-card cursor-pointer relative flex flex-col group active:scale-[0.98] transition-transform ${isWrong ? 'animate-shake' : ''}">
                        ${overlay}
                        <!-- è‰²å½©å€åŸŸ (ä½”ç´„ 70%) -->
                        <div class="w-full h-[70%] relative" style="background-color: ${displayHex}"></div>
                        
                        <!-- ç™½è‰²åº•å±¤è‰²ç¥¨æ–‡å­—å€åŸŸ -->
                        <div class="flex-1 bg-white p-3 md:p-4 flex flex-col justify-start text-left select-none relative z-10 overflow-hidden">
                            <!-- Pantone LOGO -->
                            <img src="${LOGO_URL}" class="h-3 md:h-4 w-auto object-contain object-left mb-2.5 opacity-90" alt="Pantone">
                            
                            <div class="flex flex-col">
                                <!-- è‰²è™Ÿ (æ¨™æº–æ’ç‰ˆï¼šLOGO ä¸‹æ–¹ç‚ºè‰²è™Ÿ) -->
                                <div class="text-[11px] md:text-xs font-bold text-gray-900 font-sans tracking-tight mb-0.5">${state.currentBase.code}</div>
                                <!-- è‰²å½©è‹±æ–‡åç¨± (å¤§å¯«ä¸”åŠ ç²—) -->
                                <div class="text-xs md:text-sm font-black text-gray-900 leading-tight uppercase tracking-wide truncate">
                                    ${state.currentBase.name}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            return `
                <div class="animate-fade-in w-full h-full flex flex-col max-w-md mx-auto">
                    <div class="text-center mb-4 md:mb-6 mt-2">
                        <div class="inline-block bg-white px-6 py-3 shadow-sm border border-gray-200">
                            <p class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-1">MISSION</p>
                            <p class="text-base md:text-lg font-bold text-slate-800">
                                è«‹å•å“ªä¸€å€‹é¡è‰²<span class="text-red-500 font-black mx-1">ä¸æ˜¯</span> ${state.currentBase.nameCN}ï¼Ÿ
                            </p>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4 md:gap-6 w-full pb-4">
                        ${cardsHtml}
                    </div>
                </div>
            `;
        };

        // 4. Game Over View
        const renderGameOver = () => {
            const f = state.failedDetails;
            const currentTitle = getRankTitle(state.level);
            
            let reviveBtn = '';
            if (!state.hasRevived) {
                reviveBtn = `
                    <div class="flex flex-col gap-3 mb-6">
                        <button id="btn-share-revive" class="w-full bg-[#06C755] text-white py-4 font-bold shadow-lg hover:bg-[#05b34d] transition-all flex items-center justify-center gap-2 active:scale-[0.98]">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="white"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg>
                            <span>åˆ†äº«å¥½å‹æ¥é—œ (å®Œæˆå¾Œå¯é ˜é»æ•¸)</span>
                        </button>

                        <button id="btn-trigger-revive" class="w-full bg-indigo-600 text-white py-4 font-bold shadow-lg hover:bg-indigo-700 transition-all flex items-center justify-center gap-2 active:scale-[0.98]">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
                            <span>äº†è§£ 2026 Cloud Dancer æ¥é—œ</span>
                        </button>
                        <p class="text-[10px] text-gray-400 mt-1">æ¯å±€åƒ…é™é¸æ“‡ä¸€ç¨®æ–¹å¼æ¥é—œä¸€æ¬¡</p>
                    </div>
                `;
            } else {
                 if (state.pendingPointsClaim) {
                    reviveBtn = `
                        <div class="mb-6 animate-pop">
                            <div class="text-xs font-bold text-green-600 uppercase tracking-widest mb-2">åˆ†äº«ä»»å‹™å·²å®Œæˆ</div>
                            <button id="btn-claim-points" class="w-full bg-[#06C755] text-white py-4 font-bold shadow-lg hover:bg-[#05b34d] transition-all flex items-center justify-center gap-2 active:scale-[0.98]">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="white"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15l-5-5 1.41-1.41L11 14.17l7.59-7.59L20 8l-9 9z"/></svg>
                                <span>å‰å¾€ LINE é ˜å–é›†é»é»æ•¸</span>
                            </button>
                        </div>
                    `;
                 } else {
                    reviveBtn = `
                        <div class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-6">æ¥é—œæ©Ÿæœƒå·²ç”¨ç›¡</div>
                    `;
                 }
            }

            return `
                <div class="animate-fade-in w-full max-w-md mx-auto bg-white shadow-2xl overflow-hidden border-t-8 border-black">
                    <div class="p-8 text-center">
                        <div class="w-20 h-20 bg-gray-100 flex items-center justify-center mx-auto mb-6 text-4xl shadow-inner border border-gray-200">ğŸ†</div>
                        
                        <h2 class="text-3xl font-black text-slate-900 mb-1 uppercase tracking-tight">Game Over</h2>
                        
                        <!-- ç¨±è™Ÿé¡¯ç¤ºå€åŸŸ -->
                        <div class="my-6 py-4 bg-gray-50 border border-gray-100 relative">
                            <div class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-1">ç²å¾—ç¨±è™Ÿ (Rank)</div>
                            <div class="text-2xl font-black text-indigo-600">${currentTitle}</div>
                            <div class="text-sm font-bold text-slate-400 mt-1">Level ${state.level}</div>
                        </div>

                        ${reviveBtn}

                        <div class="bg-slate-50 p-5 text-left mb-6 border-l-4 border-red-500 shadow-sm">
                            <div class="flex items-center justify-between mb-4">
                                <span class="text-xs font-bold text-gray-400 uppercase">Analysis</span>
                                <span class="text-xs font-bold text-red-500">å·®ç•°åº¦ ${f.difference}%</span>
                            </div>
                            
                            <div class="flex items-center gap-4">
                                <div class="flex flex-col items-center gap-1">
                                    <div class="w-12 h-12 shadow-sm border border-gray-200" style="background-color: ${f.oddHex}"></div>
                                    <span class="text-[10px] font-bold text-gray-500">è©²é¡Œè®Šç•°è‰²</span>
                                </div>
                                <div class="flex-1 h-px bg-gray-300 relative">
                                    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white px-2 text-[10px] text-gray-400 font-mono">VS</div>
                                </div>
                                <div class="flex flex-col items-center gap-1">
                                    <div class="w-12 h-12 shadow-sm border border-gray-200" style="background-color: ${f.baseHex}"></div>
                                    <span class="text-[10px] font-bold text-gray-500">æ­£ç¢ºåŸè‰²</span>
                                </div>
                            </div>
                        </div>

                        <div class="flex gap-3">
                            <button id="btn-restart" class="flex-1 bg-black text-white py-3 font-bold hover:bg-neutral-800 transition-colors active:scale-[0.98]">
                                é‡æ–°æŒ‘æˆ°
                            </button>
                            <button id="btn-leaderboard" class="w-14 bg-gray-100 text-black py-3 font-bold hover:bg-gray-200 transition-colors flex items-center justify-center active:scale-[0.98]">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>
                            </button>
                        </div>
                    </div>
                </div>
            `;
        };

        // --- Controller ---
        const render = () => {
            const app = document.getElementById('app');
            const header = document.getElementById('main-header');
            const levelBadge = document.getElementById('level-badge');
            const levelNum = document.getElementById('level-num');
            const headerLeaderboard = document.getElementById('btn-header-leaderboard');

            // Header state
            if (state.view === 'playing') {
                levelBadge.classList.remove('hidden');
                levelNum.textContent = state.level;
                headerLeaderboard.classList.add('hidden');
            } else {
                levelBadge.classList.add('hidden');
                headerLeaderboard.classList.remove('hidden');
            }

            // Render view
            switch(state.view) {
                case 'home': app.innerHTML = renderHome(); break;
                case 'intro': app.innerHTML = renderIntro(); break;
                case 'playing': app.innerHTML = renderPlaying(); break;
                case 'gameover': app.innerHTML = renderGameOver(); break;
                case 'leaderboard': app.innerHTML = renderLeaderboard(); break;
            }

            bindEvents();
        };

        const bindEvents = () => {
            // Home
            document.getElementById('btn-random')?.addEventListener('click', startRandomGame);
            document.querySelectorAll('.pantone-card[data-action="intro"]').forEach(card => {
                card.addEventListener('click', () => {
                    const year = parseInt(card.dataset.year);
                    const name = card.dataset.name;
                    state.introBase = PANTONE_YEARS.find(p => p.year === year && p.name === name);
                    state.view = 'intro';
                    render();
                    window.scrollTo(0,0);
                });
            });

            // Intro
            document.getElementById('btn-intro-close')?.addEventListener('click', () => {
                state.view = 'home';
                render();
            });
            document.getElementById('btn-start-challenge')?.addEventListener('click', startGameFromIntro);

            // Playing
            document.querySelectorAll('.pantone-card[data-card-index]').forEach(card => {
                card.addEventListener('click', () => handleCardClick(parseInt(card.dataset.cardIndex)));
            });

            // Game Over
            document.getElementById('btn-restart')?.addEventListener('click', () => {
                state.view = 'home';
                render();
            });
            document.getElementById('btn-leaderboard')?.addEventListener('click', () => {
                state.view = 'leaderboard';
                render();
            });
            
            // Revive Triggers
            document.getElementById('btn-trigger-revive')?.addEventListener('click', openReviveModal);
            document.getElementById('btn-share-revive')?.addEventListener('click', handleShareRevive);
            
            // Claim Points Trigger (Only present when pendingPointsClaim is true)
            document.getElementById('btn-claim-points')?.addEventListener('click', handleClaimPoints);

            // Leaderboard
            document.getElementById('btn-back')?.addEventListener('click', () => {
                state.view = 'home';
                render();
            });
        };

        // Header Buttons
        document.getElementById('btn-header-leaderboard').addEventListener('click', () => {
            state.view = 'leaderboard';
            render();
        });

        // Revive Modal Confirm
        document.getElementById('btn-confirm-revive').addEventListener('click', confirmRevive);

        // Init LIFF & Game
        window.onload = function() {
            // Init Game UI
            render();

            // Init LIFF (with safety check for preview environment)
            if (typeof liff !== 'undefined') {
                liff.init({ liffId: LIFF_ID })
                    .then(() => {
                        console.log("LIFF Initialized");
                        if (!liff.isLoggedIn() && liff.isInClient()) {
                            // liff.login(); 
                        }
                    })
                    .catch((err) => {
                        console.warn("LIFF Init Failed or not in LINE environment", err);
                    });
            } else {
                console.warn("LIFF SDK not loaded");
            }
        };

    </script>
</body>
</html>
